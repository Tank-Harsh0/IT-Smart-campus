{% extends 'base_public.html' %}

{% block title %}Faculty | IT Department - RCTI{% endblock %}

{% block extra_css %}
.modal-avatar-ring {
background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 100%);
padding: 4px;
border-radius: 50%;
}

.tech-tag {
font-size: 0.75rem;
padding: 0.375rem 0.75rem;
background: #f1f5f9;
border: 1px solid #e2e8f0;
border-radius: 0.5rem;
color: #475569;
font-weight: 500;
}
{% endblock %}

{% block content %}
<header class="pt-32 pb-16 px-4 text-center max-w-4xl mx-auto">
  <span
    class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 text-xs font-bold uppercase tracking-wider mb-4 inline-block">
    Department of Information Technology
  </span>
  <h1 class="text-4xl md:text-5xl font-bold font-tech text-slate-900 mb-6">
    Meet the Minds Behind <br />
    <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-cyan-500">Your Future Success</span>
  </h1>
  <p class="text-lg text-slate-500 leading-relaxed">
    Our faculty members are a blend of experienced academicians and industry
    experts dedicated to shaping the next generation of tech leaders.
  </p>

  <div
    class="grid grid-cols-3 gap-4 max-w-2xl mx-auto mt-12 bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
    <div>
      <p class="text-2xl font-bold text-slate-900">{{ faculty_list.count }}</p>
      <p class="text-xs text-slate-400 uppercase font-bold">Faculty Members</p>
    </div>
    <div class="border-l border-slate-100">
      <p class="text-2xl font-bold text-slate-900">{{ avg_experience }}yrs</p>
      <p class="text-xs text-slate-400 uppercase font-bold">Avg. Experience</p>
    </div>
    <div class="border-l border-slate-100">
      <p class="text-2xl font-bold text-slate-900">{{ teacher_ratio }}</p>
      <p class="text-xs text-slate-400 uppercase font-bold">Teacher Ratio</p>
    </div>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 pb-24">
  <div class="mb-16">
    <h2 class="text-xl font-bold font-tech text-slate-900 mb-8 flex items-center gap-3">
      <span class="w-8 h-1 bg-cyan-500 rounded-full"></span> Department Experts
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for faculty in faculty_list %}
      <div class="glass-card p-6 rounded-2xl relative group">
        <div class="flex items-start justify-between mb-6">
          <div class="w-16 h-16 rounded-2xl bg-slate-100 overflow-hidden">
            {% if faculty.photo %}
            <img src="{{ faculty.photo.url }}" class="w-full h-full object-cover"
              alt="{{ faculty.user.get_full_name }}" />
            {% else %}
            <img
              src="https://ui-avatars.com/api/?name={{ faculty.user.first_name }}+{{ faculty.user.last_name }}&background=2563eb&color=fff"
              class="w-full h-full object-cover" />
            {% endif %}
          </div>
          <span class="badge bg-blue-50 text-blue-600 px-2 py-1 rounded-lg">{{ faculty.designation }}</span>
        </div>
        <h3 class="text-lg font-bold text-slate-900">{{ faculty.user.get_full_name }}</h3>
        <p class="text-sm text-slate-500 font-medium mb-4">
          {% if faculty.qualification %}{{ faculty.qualification }}{% endif %}
          {% if faculty.portfolio %} • {{ faculty.portfolio }}{% endif %}
        </p>

        {% if faculty.area_of_interest %}
        <div class="flex flex-wrap gap-2 mb-6">
          {% for skill in faculty.area_of_interest.split %}
          <span class="text-[10px] px-2 py-1 bg-slate-50 border border-slate-100 rounded text-slate-600">{{ skill
            }}</span>
          {% endfor %}
        </div>
        {% else %}
        <div class="mb-6"></div>
        {% endif %}

        <button type="button" data-faculty-open data-faculty-id="{{ faculty.pk }}"
          data-faculty-name="{{ faculty.user.get_full_name }}"
          data-faculty-photo="{% if faculty.photo %}{{ faculty.photo.url }}{% else %}https://ui-avatars.com/api/?name={{ faculty.user.first_name }}+{{ faculty.user.last_name }}&background=fff&color=0f172a&size=128{% endif %}"
          data-faculty-designation="{{ faculty.designation }}" data-faculty-qualification="{{ faculty.qualification }}"
          data-faculty-interest="{{ faculty.area_of_interest }}" data-faculty-portfolio="{{ faculty.portfolio }}"
          data-faculty-dept-joining="{{ faculty.dept_joining_date|date:'d M Y'|default:'' }}"
          data-faculty-inst-joining="{{ faculty.institute_joining_date|date:'d M Y'|default:'' }}"
          data-faculty-email="{{ faculty.user.email }}" data-faculty-emp-id="{{ faculty.employee_id }}"
          class="block w-full py-2 rounded-xl bg-white border border-slate-200 text-center text-sm font-bold text-slate-600 group-hover:bg-blue-600 group-hover:text-white group-hover:border-blue-600 transition-all cursor-pointer">
          View Profile
        </button>
      </div>
      {% empty %}
      <div class="col-span-full text-center py-16">
        <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
          <i class="fa-solid fa-users text-3xl text-slate-400"></i>
        </div>
        <h3 class="text-xl font-bold text-slate-700 mb-2">No Faculty Data Yet</h3>
        <p class="text-slate-500">Faculty profiles will appear here once added by the admin.</p>
      </div>
      {% endfor %}
    </div>
  </div>
</main>

<!-- FACULTY PROFILE MODAL -->
<div id="facultyModal" class="fixed inset-0 z-[9999] hidden" role="dialog" aria-modal="true">
  <div id="fModalBackdrop"
    class="fixed inset-0 bg-slate-900/40 backdrop-blur-md opacity-0 transition-opacity duration-300 ease-out"></div>
  <div class="fixed inset-0 z-10 overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4">
      <div id="fModalPanel"
        class="relative w-full max-w-2xl transform overflow-hidden rounded-3xl bg-white shadow-2xl transition-all scale-95 opacity-0 duration-300 ease-out border border-white/50">
        <div class="h-32 bg-gradient-to-r from-slate-800 to-slate-900 relative overflow-hidden">
          <div
            class="absolute right-0 top-0 w-64 h-64 bg-blue-500 rounded-full blur-[80px] opacity-20 translate-x-1/3 -translate-y-1/2">
          </div>
          <button data-faculty-close
            class="absolute top-4 right-4 w-8 h-8 bg-black/20 hover:bg-black/40 text-white rounded-full flex items-center justify-center transition-colors backdrop-blur-sm">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="px-8 pb-8">
          <div class="relative -mt-16 mb-6 flex justify-between items-end">
            <div class="modal-avatar-ring w-32 h-32">
              <img id="modalPhoto" src=""
                class="w-full h-full rounded-full border-4 border-white object-cover bg-white" />
            </div>
            <div class="flex gap-3 mb-2">
              <a id="modalEmail" href="#"
                class="px-4 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-bold hover:bg-blue-100 transition-colors flex items-center gap-2">
                <i class="fa-solid fa-envelope"></i> Email
              </a>
            </div>
          </div>
          <div class="mb-8">
            <h2 id="modalName" class="text-3xl font-bold font-tech text-slate-900"></h2>
            <p id="modalDesignation" class="text-slate-500 font-medium"></p>
            <div class="flex items-center gap-4 mt-4 text-sm text-slate-600">
              <span class="flex items-center gap-1.5">
                <i class="fa-solid fa-graduation-cap text-blue-500"></i>
                <span id="modalQualification"></span>
              </span>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 border-t border-slate-100 pt-8">
            <div class="space-y-6">
              <div>
                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Area of Interest</h4>
                <div id="modalInterests" class="flex flex-wrap gap-2"></div>
              </div>
              <div id="portfolioSection">
                <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Current Portfolio</h4>
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-xl border border-slate-100">
                  <div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center text-blue-600">
                    <i class="fa-solid fa-users-gear"></i>
                  </div>
                  <div>
                    <p id="modalPortfolio" class="text-sm font-bold text-slate-900"></p>
                    <p class="text-[10px] text-slate-500">Institute Level</p>
                  </div>
                </div>
              </div>
            </div>
            <div>
              <h4 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-4">Journey at RCTI</h4>
              <div class="relative space-y-6 pl-2">
                <div class="absolute left-[7px] top-2 bottom-2 w-0.5 bg-slate-200"></div>
                <div class="relative pl-6" id="instJoiningSection">
                  <div class="absolute left-0 top-1.5 w-4 h-4 bg-blue-600 rounded-full border-4 border-white shadow-sm">
                  </div>
                  <p class="text-sm font-bold text-slate-900">Institute Joining</p>
                  <p id="modalInstJoining" class="text-xs text-blue-600 font-bold"></p>
                </div>
                <div class="relative pl-6" id="deptJoiningSection">
                  <div class="absolute left-0 top-1.5 w-4 h-4 bg-slate-300 rounded-full border-4 border-white"></div>
                  <p class="text-sm font-bold text-slate-900">Dept Joining</p>
                  <p id="modalDeptJoining" class="text-xs text-slate-500 font-bold"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-slate-50 px-8 py-4 border-t border-slate-100 flex justify-between items-center">
          <span id="modalEmpId" class="text-xs text-slate-400 font-bold"></span>
          <button data-faculty-close class="text-sm font-bold text-blue-600 hover:underline">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("facultyModal");
    const backdrop = document.getElementById("fModalBackdrop");
    const panel = document.getElementById("fModalPanel");

    function openFacultyModal(data) {
      document.getElementById("modalPhoto").src = data.photo;
      document.getElementById("modalName").textContent = data.name;
      document.getElementById("modalDesignation").textContent = data.designation + " • Information Technology";
      document.getElementById("modalQualification").textContent = data.qualification || "N/A";
      document.getElementById("modalEmail").href = "mailto:" + data.email;

      const interestsContainer = document.getElementById("modalInterests");
      interestsContainer.innerHTML = "";
      if (data.interest) {
        data.interest.split(/[,\s]+/).forEach(skill => {
          if (skill.trim()) {
            const tag = document.createElement("span");
            tag.className = "tech-tag";
            tag.textContent = skill.trim();
            interestsContainer.appendChild(tag);
          }
        });
      }

      const portfolioSection = document.getElementById("portfolioSection");
      if (data.portfolio) {
        portfolioSection.style.display = "block";
        document.getElementById("modalPortfolio").textContent = data.portfolio;
      } else {
        portfolioSection.style.display = "none";
      }

      const instSection = document.getElementById("instJoiningSection");
      const deptSection = document.getElementById("deptJoiningSection");

      if (data.instJoining) {
        instSection.style.display = "block";
        document.getElementById("modalInstJoining").textContent = data.instJoining;
      } else {
        instSection.style.display = "none";
      }

      if (data.deptJoining) {
        deptSection.style.display = "block";
        document.getElementById("modalDeptJoining").textContent = data.deptJoining;
      } else {
        deptSection.style.display = "none";
      }

      document.getElementById("modalEmpId").textContent = "ID: " + data.empId;

      modal.classList.remove("hidden");
      requestAnimationFrame(() => {
        backdrop.classList.remove("opacity-0");
        panel.classList.remove("opacity-0", "scale-95");
        panel.classList.add("opacity-100", "scale-100");
      });
    }

    function closeFacultyModal() {
      backdrop.classList.add("opacity-0");
      panel.classList.remove("opacity-100", "scale-100");
      panel.classList.add("opacity-0", "scale-95");
      setTimeout(() => modal.classList.add("hidden"), 300);
    }

    document.addEventListener("click", (e) => {
      const openBtn = e.target.closest("[data-faculty-open]");
      if (openBtn) {
        openFacultyModal({
          name: openBtn.dataset.facultyName,
          photo: openBtn.dataset.facultyPhoto,
          designation: openBtn.dataset.facultyDesignation,
          qualification: openBtn.dataset.facultyQualification,
          interest: openBtn.dataset.facultyInterest,
          portfolio: openBtn.dataset.facultyPortfolio,
          deptJoining: openBtn.dataset.facultyDeptJoining,
          instJoining: openBtn.dataset.facultyInstJoining,
          email: openBtn.dataset.facultyEmail,
          empId: openBtn.dataset.facultyEmpId
        });
      }
      if (e.target.closest("[data-faculty-close]")) closeFacultyModal();
      if (e.target === backdrop) closeFacultyModal();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !modal.classList.contains("hidden")) closeFacultyModal();
    });
  });
</script>
{% endblock %}