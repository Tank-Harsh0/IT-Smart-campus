{% extends 'base.html' %}

{% block content %}
{% include 'partials/admin_sidebar.html' %}
<div
  class="flex-1 flex flex-col h-screen overflow-hidden relative bg-[#f8fafc]"
>
  <header
    class="h-20 bg-white/80 backdrop-blur-md border-b border-slate-200 flex items-center justify-between px-6 z-40"
  ><button
    id="menuBtn"
    class="p-2 rounded-lg hover:bg-slate-100"
    aria-label="Open sidebar"
  >
    <i class="fa-solid fa-bars text-xl"></i>
  </button>
    <div>
      <h2 class="text-xl font-bold font-tech text-slate-800">
        Import Subjects
      </h2>
      <p class="text-xs text-slate-500">Update curriculum and course details</p>
    </div>
    <a
      href="{% url 'subject_list' %}"
      class="text-xs font-bold text-slate-500 hover:text-blue-600 transition flex items-center"
    >
      <i class="fa-solid fa-arrow-left mr-2"></i> Back to List
    </a>
  </header>

  <main
    class="flex-1 overflow-y-auto p-8 custom-scroll flex items-center justify-center"
  >
    <div class="max-w-5xl w-full grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div
        class="bg-gradient-to-br from-orange-500 to-red-500 rounded-[2rem] p-8 text-white relative overflow-hidden shadow-xl shadow-orange-500/30 flex flex-col justify-between min-h-[400px]"
      >
        <div
          class="absolute bottom-0 left-0 w-64 h-64 bg-white rounded-full blur-[100px] opacity-20 pointer-events-none"
        ></div>

        <div class="relative z-10">
          <div
            class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center mb-6 backdrop-blur-sm border border-white/10"
          >
            <i class="fa-solid fa-book-open text-2xl text-white"></i>
          </div>

          <h3 class="text-2xl font-bold font-tech mb-2">Curriculum Format</h3>
          <p class="text-orange-100 text-sm mb-6">
            Ensure the subject codes match the GTU/University syllabus.
          </p>

          <ul class="space-y-4 text-orange-50 text-sm">
            <li class="flex items-start gap-3">
              <i class="fa-solid fa-circle-check mt-1 text-yellow-300"></i>
              <span>File must be in <strong>.CSV</strong> format.</span>
            </li>
            <li class="flex items-start gap-3">
              <i class="fa-solid fa-table-columns mt-1 text-yellow-300"></i>
              <div>
                <span class="block mb-1">Required Columns:</span>
                <div class="flex flex-wrap gap-1">
                  <code
                    class="bg-black/20 px-1.5 py-0.5 rounded text-[10px] font-mono border border-white/10"
                    >name</code
                  >
                  <code
                    class="bg-black/20 px-1.5 py-0.5 rounded text-[10px] font-mono border border-white/10"
                    >code</code
                  >
                  <code
                    class="bg-black/20 px-1.5 py-0.5 rounded text-[10px] font-mono border border-white/10"
                    >semester</code
                  >
                  <code
                    class="bg-black/20 px-1.5 py-0.5 rounded text-[10px] font-mono border border-white/10"
                    >credits</code
                  >
                </div>
              </div>
            </li>
          </ul>
        </div>

        <div class="relative z-10 mt-8 pt-6 border-t border-white/10">
          <p
            class="text-xs text-orange-200 mb-3 font-bold uppercase tracking-wider"
          >
            Start with a template
          </p>
          <a
            href="{% url 'download_sample_subjects_csv' %}"
            class="flex items-center justify-center gap-2 w-full py-3 bg-white text-orange-600 rounded-xl font-bold hover:bg-orange-50 transition shadow-lg group"
          >
            <i
              class="fa-solid fa-download group-hover:scale-110 transition-transform"
            ></i>
            Download Subject CSV
          </a>
        </div>
      </div>

      <div
        class="bg-white rounded-[2rem] p-8 border border-slate-200 shadow-sm flex flex-col justify-center"
      >
        <form method="post" enctype="multipart/form-data" class="space-y-6">
          {% csrf_token %}

          <div class="text-center mb-2">
            <h2 class="text-xl font-bold font-tech text-slate-800">
              Upload Subject Data
            </h2>
            <p class="text-sm text-slate-500">
              Drag & drop your curriculum file here
            </p>
          </div>

          <div class="relative group w-full h-48">
            <input
              type="file"
              name="file"
              id="fileInput"
              required
              accept=".csv"
              class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"
              onchange="updateFileName(this)"
            />

            <div
              id="dropZone"
              class="absolute inset-0 border-2 border-dashed border-slate-300 rounded-2xl flex flex-col items-center justify-center transition-all group-hover:border-orange-500 group-hover:bg-orange-50/50"
            >
              <div
                class="w-14 h-14 bg-slate-50 rounded-full flex items-center justify-center mb-3 group-hover:bg-white group-hover:shadow-md transition-all"
              >
                <i
                  class="fa-solid fa-cloud-arrow-up text-2xl text-slate-400 group-hover:text-orange-500 transition-colors"
                ></i>
              </div>
              <p
                id="fileName"
                class="text-sm font-bold text-slate-600 group-hover:text-orange-600 transition-colors px-4 text-center truncate w-full"
              >
                Click to browse
              </p>
              <p class="text-xs text-slate-400 mt-1">Max file size: 2MB</p>
            </div>
          </div>

          <button
            type="submit"
            class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold hover:bg-orange-600 transition shadow-lg hover:shadow-orange-500/20 flex items-center justify-center gap-2 transform active:scale-95"
          >
            <i class="fa-solid fa-layer-group"></i> Add Subjects
          </button>
        </form>

        {% if messages %}
        <div class="mt-6 space-y-2 animate-fade-in-up">
          {% for message in messages %}
          <div
            class="p-3 rounded-lg text-xs font-bold flex items-start gap-2 {% if 'success' in message.tags %}bg-green-50 text-green-600 border border-green-100 {% elif 'error' in message.tags %}bg-red-50 text-red-600 border border-red-100 {% else %}bg-orange-50 text-orange-600 border border-orange-100{% endif %}"
          >
            <i class="fa-solid fa-circle-info mt-0.5"></i>
            <span>{{ message }}</span>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </div>
  </main>
</div>

<script>
  function updateFileName(input) {
    const fileName = input.files[0] ? input.files[0].name : "Click to browse";
    const dropZone = document.getElementById("dropZone");
    const fileNameDisplay = document.getElementById("fileName");

    if (input.files[0]) {
      fileNameDisplay.textContent = "Selected: " + fileName;
      fileNameDisplay.classList.remove("text-slate-600");
      fileNameDisplay.classList.add("text-orange-600");
      dropZone.classList.add("border-orange-500", "bg-orange-50");
      dropZone.classList.remove("border-slate-300");
    }
  }
</script>

<style>
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .animate-fade-in-up {
    animation: fadeInUp 0.4s ease-out forwards;
  }
</style>
{% endblock content %}
